# 一、员工资料 - 基本资料

## 1.1. 后端员工信息分页列表接口 开发

需求：

* 将查询内容进行分页处理

注意：

* 先将 Employee 中的变量名修改成驼峰表示，Mapper层也需要同步修改

* 在 Employee 类中添加下面的五个对象，用来查询时返回一对一对象数据

  ```java
  private Nation nation;
  private Politicsstatus politicsstatus;
  private Department department;
  private JobLevel jobLevel;
  private Position position;
  ```

* 并且给 Employee 中表示日期的变量添加 `@JsonFormat()` 注解，用于日期格式化

创建一个分页Bean，专门用来存储并返回分页信息

````java
public class RespPageBean {
  /* 总记录数 */
  private Long total;
  /* 分页内容 */
  private List<?> data;

  public Long getTotal() {
    return total;
  }

  public void setTotal(Long total) {
    this.total = total;
  }

  public List<?> getData() {
    return data;
  }

  public void setData(List<?> data) {
    this.data = data;
  }
}
````

Controller层

```java
@RestController
@RequestMapping("/emp/basic")
public class EmpBasicController {

  @Autowired
  EmployeeService employeeService;

  @GetMapping("/")
  public RespPageBean getEmployeeByPage(@RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "10") Integer size) {
    return employeeService.getEmployeeByPage(page, size);
  }
}
```

Service层

```java
@Service
public class EmployeeService {

  @Autowired
  EmployeeMapper employeeMapper;

  public RespPageBean getEmployeeByPage(Integer page, Integer size) {
    if (page != null && size != null) {
      page = (page - 1) * size;
    }
    
    List<Employee> data = employeeMapper.getEmployeeByPage(page, size);
    Long total = employeeMapper.getTotal();
    RespPageBean bean = new RespPageBean();
    bean.setData(data);
    bean.setTotal(total);
    return bean;
  }
}
```

Mapper层

```java
public interface EmployeeMapper {

  List<Employee> getEmployeeByPage(@Param("page") Integer page,@Param("size") Integer size);

  Long getTotal();
}
```

```xml
<resultMap id="AllEmployeeInfo" type="org.javaboy.vhr.model.Employee" extends="BaseResultMap">
  <association property="nation" javaType="org.javaboy.vhr.model.Nation">
    <id column="nid" property="id"></id>
    <result column="nname" property="name"></result>
  </association>
  <association property="politicsstatus" javaType="org.javaboy.vhr.model.Politicsstatus">
    <id column="pid" property="id"></id>
    <result column="pname" property="name"></result>
  </association>
  <association property="department" javaType="org.javaboy.vhr.model.Department">
    <id column="did" property="id"></id>
    <result column="dname" property="name"></result>
  </association>
  <association property="jobLevel" javaType="org.javaboy.vhr.model.JobLevel">
    <id column="jid" property="id"></id>
    <result column="jname" property="name"></result>
  </association>
  <association property="position" javaType="org.javaboy.vhr.model.Position">
    <id column="posid" property="id"></id>
    <result column="posname" property="name"></result>
  </association>
</resultMap>
<select id="getEmployeeByPage" resultMap="AllEmployeeInfo">
  select
  e.*,
  p.`id` as pid,p.`name` as pname,
  n.`id` as nid,n.`name` as nname,
  d.`id` as did,d.`name` as dname,
  j.`id` as jid,j.`name` as jname,
  pos.`id` as posid,pos.`name` as posname
  from employee e,nation n,politicsstatus p,department d,joblevel j,position pos
  where
  e.`nationId` = n.`id` and
  e.`politicId` = p.`id` and
  e.`departmentId` = d.`id` and
  e.`jobLevelId` = j.`id` and
  e.`posId` = pos.`id` limit #{page},#{size}
</select>
<select id="getTotal" resultType="java.lang.Long">
  select count(*) from employee
</select>
```

## 1.2. 前端组件开发、接口对接

```vue
<template>
<div>
  <div style="display: flex;justify-content: space-between">
    <div>
      <el-input placeholder="请输入员工名进行搜索，可以直接回车搜索…" prefix-icon="el-icon-search"
                style="width: 300px;margin-right: 10px;"></el-input>
      <el-button icon="el-icon-search" type="primary">搜索</el-button>
      <el-button type="primary">
        <i class="fa fa-angle-double-down" aria-hidden="true"></i>
        高级搜索
  </el-button>
  </div>
    <div>
      <el-button type="success">
        <i class="fa fa-level-up" aria-hidden="true"></i>
        导入数据
  </el-button>
      <el-button type="success">
        <i class="fa fa-level-down" aria-hidden="true"></i>
        导出数据
  </el-button>
      <el-button type="primary" icon="el-icon-plus">
        添加用户
  </el-button>
  </div>
  </div>
  <div style="margin-top: 10px;">
    <el-table
              :data="emps"
              stripe
              v-loading="loading"
              element-loading-text="正在加载中…"
              element-loading-spinner="el-icon-loading"
              element-loading-background="rgba(0, 0, 0, 0.8)"
              border
              style="width: 100%">
      <el-table-column
                       type="selection"
                       width="55">
  </el-table-column>
      <el-table-column
                       prop="name"
                       label="姓名"
                       fixed
                       align="center"
                       width="90">
  </el-table-column>
      <el-table-column
                       prop="workID"
                       label="工号"
                       align="left"
                       width="85">
  </el-table-column>
      <el-table-column
                       prop="birthday"
                       label="出生日期"
                       align="center"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="idCard"
                       label="身份证号码"
                       align="center"
                       width="150">
  </el-table-column>
      <el-table-column
                       prop="wedlock"
                       label="婚姻状况"
                       align="center"
                       width="70">
  </el-table-column>
      <el-table-column
                       prop="nation.name"
                       label="民族"
                       align="center"
                       width="50">
  </el-table-column>
      <el-table-column
                       prop="nativePlace"
                       label="籍贯"
                       align="left"
                       width="80">
  </el-table-column>
      <el-table-column
                       prop="politicsstatus.name"
                       align="center"
                       label="政治面貌">
  </el-table-column>
      <el-table-column
                       prop="email"
                       label="电子邮件"
                       align="left"
                       width="180">
  </el-table-column>
      <el-table-column
                       prop="phone"
                       label="电话号码"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="address"
                       label="联系地址"
                       align="left"
                       width="220">
  </el-table-column>
      <el-table-column
                       prop="department.name"
                       label="所属部门"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="position.name"
                       label="职位"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="jobLevel.name"
                       label="职称"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="engageForm"
                       label="聘用形式"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="beginDate"
                       label="入职日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="conversionTime"
                       label="转正日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="beginContract"
                       label="合同起始日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="endContract"
                       label="合同截止日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       label="合同期限"
                       align="left"
                       width="100">
        <template slot-scope="scope">
          <el-tag>{{scope.row.contractTerm}}</el-tag>
          年
</template>
</el-table-column>
<el-table-column
                 prop="tiptopDegree"
                 label="最高学历">
</el-table-column>
<el-table-column
                 fixed="right"
                 width="200"
                 label="操作">
  <template slot-scope="scope">
<el-button style="padding: 2px" size="mini">编辑</el-button>
<el-button style="padding: 2px" size="mini" type="primary">查看高级资料</el-button>
<el-button style="padding: 2px" size="mini" type="danger">删除</el-button>
  </template>
</el-table-column>
</el-table>
</div>
</div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        emps: [],
        loading: false,
      }
    },
    mounted() {
      this.initEmps()
    },
    methods: {
      initEmps() {
        this.loading = true
        this.getRequest("/emp/basic/").then(res => {
          this.loading = false
          if (res) {
            this.emps = res.data
          }
        })
      }
    }
  }
</script>
```

---

出现表格的表头和表内容不对称的问题，解决方案：

* 在 assets 文件夹下创建 css/base.css 文件，并在里面书写样式：

  ```css
  .el-table th.gutter{
    display: table-cell!important;
  }
  ```

* 在 App.vue 文件中引入样式文件 base.css

  ```vue
  <template>
  <div id="app">
    <router-view/>
    </div>
  </template>
  
  <style>
    @import "assets/css/base.css";
  </style>
  ```

注意：必须是全局文件，单单在 vue 文件中输入样式会无效

## 1.3. 前端组件添加分页功能

```vue
<template>
 <div style="display: flex;justify-content: flex-end;">
  <!-- 分页功能 -->
  <el-pagination
                 @current-change="currentChange"
                 @size-change="sizeChange"
                 background
                 layout="sizes, prev, pager, next, jumper, ->, total, slot"
                 :total="total">
  </el-pagination>
  </div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        emps: [],
        loading: false,
        total: 0,
        page: 1,
        size: 10
      }
    },
    mounted() {
      this.initEmps()
    },
    methods: {
      initEmps() {
        this.loading = true
        this.getRequest("/emp/basic/?page="+this.page+"&size="+this.size).then(res => {
          this.loading = false
          if (res) {
            this.total = res.total
            this.emps = res.data
          }
        })
      },
      // 页发生变化
      currentChange(currentPage){
        this.page = currentPage;
        this.initEmps()
      },
      // 条数发生变化
      sizeChange(currentSize){
        this.size = currentSize;
        this.initEmps()
      }
    }
  }
</script>
```

## 1.4. 前后端 - 员工搜索功能

直接修改之前后端的语句即可

* 在之前查询的方法上添加多一个参数 `keyword`，用来查询数据

Controller 层

```java
@RestController
@RequestMapping("/emp/basic")
public class EmpBasicController {

  @Autowired
  EmployeeService employeeService;

  // 添加多一个 keyword，用来查询员工
  @GetMapping("/")
  public RespPageBean getEmployeeByPage(@RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "10") Integer size,String keyword) {
    return employeeService.getEmployeeByPage(page, size, keyword);
  }
}

```

Service 层

```java
@Service
public class EmployeeService {

  @Autowired
  EmployeeMapper employeeMapper;

  public RespPageBean getEmployeeByPage(Integer page, Integer size, String keyword) {
    if (page != null && size != null) {
      page = (page - 1) * size;
    }
    // 在查询所有员工信息中添加多一个keyword
    List<Employee> data = employeeMapper.getEmployeeByPage(page, size, keyword);
    // 在计算员工总数目中添加多一个keyword
    Long total = employeeMapper.getTotal(keyword);
    RespPageBean bean = new RespPageBean();
    bean.setData(data);
    bean.setTotal(total);
    return bean;
  }
}

```

Mapper 层

```java
public interface EmployeeMapper {
    List<Employee> getEmployeeByPage(@Param("page") Integer page, @Param("size") Integer size,@Param("keyword") String keyword);

    Long getTotal(String keyword);
}

```

```xml
<!-- 给两个查询语句添加多一个 if 条件判断，判断keyword出现后则进行查询，没有出现则不进行查询 -->
<select id="getEmployeeByPage" resultMap="AllEmployeeInfo">
  select
  e.*,
  p.`id` as pid,p.`name` as pname,
  n.`id` as nid,n.`name` as nname,
  d.`id` as did,d.`name` as dname,
  j.`id` as jid,j.`name` as jname,
  pos.`id` as posid,pos.`name` as posname
  from employee e,nation n,politicsstatus p,department d,joblevel j,position pos
  where
  e.`nationId` = n.`id` and
  e.`politicId` = p.`id` and
  e.`departmentId` = d.`id` and
  e.`jobLevelId` = j.`id` and
  e.`posId` = pos.`id`
  <if test="keyword != null and keyword != ''">
    and e.name like concat('%',#{keyword},'%')
  </if>
  limit #{page},#{size}
</select>
<select id="getTotal" resultType="java.lang.Long">
  select count(*) from employee
  <if test="keyword != null and keyword != ''">
    where name like concat('%',#{keyword},'%')
  </if>
</select>
```

---

前端：

```vue
<template>
<div>
  <!-- input 绑定 keyword -->
      <el-input placeholder="请输入员工名进行搜索，可以直接回车搜索…" prefix-icon="el-icon-search" clearable @clear="initEmps"
                style="width: 300px;margin-right: 10px;" v-model="keyword"></el-input>
  <el-button icon="el-icon-search" type="primary" @click="initEmps">搜索</el-button>
  </div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        emps: [],
        keyword: ''
      }
    },
    methods: {
      initEmps() {
        this.loading = true
        // 请求url中添加多一个参数 &keyword= this.keyword
        this.getRequest("/emp/basic/?page="+this.page+"&size="+this.size+"&keyword="+this.keyword).then(res => {
          this.loading = false
          if (res) {
            this.total = res.total
            this.emps = res.data
          }
        })
      },
    }
  }
</script>
```

## 1.5. 前后端 - 添加员工

后端：

接口：

* 添加员工的接口
* 选择器选择对象
  * 民族的列表
  * 政治面貌列表
  * 职称列表
  * 职位列表
* 查询最大工号 + 1，返回前端（工号由数据库自增生成）
* 树的选择对象
  * 所属部门

Controller 层

```java
@RestController
@RequestMapping("/emp/basic")
public class EmpBasicController {
  @Autowired
  EmployeeService employeeService;
  @Autowired
  NationService nationService;
  @Autowired
  PoliticsstatusService politicsstatusService;
  @Autowired
  JobLevelService jobLevelService;
  @Autowired
  PositionService positionService;
  @Autowired
  DepartmentService departmentService;

  // 添加员工
  @PostMapping("/")
  public RespBean addEmp(@RequestBody Employee employee) {
    if (employeeService.addEmp(employee) == 1) {
      return RespBean.ok("添加成功！");
    }
    return RespBean.error("添加失败！");
  }

  // 获取民族列表
  @GetMapping("/nations")
  public List<Nation> getAllNations() {
    return nationService.getAllNations();
  }

  // 政治面貌
  @GetMapping("/politicsstatus")
  public List<Politicsstatus> getAllPoliticsstatus() {
    return politicsstatusService.getAllPoliticsstatus();
  }

  // 职称
  @GetMapping("/jobLevels")
  public List<JobLevel> getAllJobLevel() {
    return jobLevelService.getAllJobLevels();
  }

  // 职位
  @GetMapping("/positions")
  public List<Position> getAllPosition() {
    return positionService.getAllPositions();
  }

  // 工号
  @GetMapping("/maxWorkID")
  public RespBean maxWorkID() {
    RespBean respBean = RespBean.build().setStatus(200)
      .setObj(String.format("%08d", employeeService.maxWorkID() + 1));
    return respBean;
  }
  
  // 所属部门
  @GetMapping("/deps")
  public List<Department> getAllDepartments(){
    return departmentService.getAllDepartment();
  }
}

```

Service 层

```java
@Service
public class EmployeeService {
  @Autowired
  EmployeeMapper employeeMapper;
  // 添加员工
  public Integer addEmp(Employee employee) {
    return employeeMapper.insertSelective(employee);
  }
	// 工号
  public Integer maxWorkID() {
    return employeeMapper.maxWorkID();
  }
}
// ----
@Service
public class NationService {
  @Autowired
  NationMapper nationMapper;
	// 获取民族
  public List<Nation> getAllNations() {
    return nationMapper.getAllNations();
  }
}
// ---
@Service
public class PoliticsstatusService {
  @Autowired
  PoliticsstatusMapper politicsstatusMapper;
	// 获取政治面貌
  public List<Politicsstatus> getAllPoliticsstatus() {
    return politicsstatusMapper.getAllPoliticsstatus();
  }
}
// ---
@Service
public class JobLevelService {
  @Autowired
  JobLevelMapper jobLevelMapper;
	// 获取职称
  public List<JobLevel> getAllJobLevels() {
    return jobLevelMapper.getAllJobLevels();
  }
}
// ---
@Service
public class PositionService {
  @Autowired
  PositionMapper positionMapper;
	// 获取职位
  public List<Position> getAllPositions() {
    return positionMapper.getAllPositions();
  }
} 
```

Mapper层

* 对于职称、职位、政治面貌、民族的查询都是直接获取对应表的所有信息，这里不写

```xml
<select id="maxWorkID" resultType="java.lang.Integer">
  select max(workID) from employee
</select>

```

---

前端：

```vue
<template>
<div>
  <div style="display: flex;justify-content: space-between">
    <div>
      <el-input placeholder="请输入员工名进行搜索，可以直接回车搜索…" prefix-icon="el-icon-search"
                style="width: 300px;margin-right: 10px;" v-model="keyword" @keydown.enter.native="initEmps"
                clearable @clear="initEmps"></el-input>
      <el-button icon="el-icon-search" type="primary" @click="initEmps">搜索</el-button>
      <el-button type="primary">
        <i class="fa fa-angle-double-down" aria-hidden="true"></i>
        高级搜索
  </el-button>
  </div>
    <div>
      <el-button type="success">
        <i class="fa fa-level-up" aria-hidden="true"></i>
        导入数据
  </el-button>
      <el-button type="success">
        <i class="fa fa-level-down" aria-hidden="true"></i>
        导出数据
  </el-button>
      <el-button type="primary" icon="el-icon-plus" @click="showAddEmpView">
        添加员工
  </el-button>
  </div>
  </div>
  <div style="margin-top: 10px;">
    <el-table
              :data="emps"
              stripe
              v-loading="loading"
              element-loading-text="正在加载中…"
              element-loading-spinner="el-icon-loading"
              element-loading-background="rgba(0, 0, 0, 0.8)"
              border
              style="width: 100%">
      <el-table-column
                       type="selection"
                       width="55">
  </el-table-column>
      <el-table-column
                       prop="name"
                       label="姓名"
                       fixed
                       align="center"
                       width="90">
  </el-table-column>
      <el-table-column
                       prop="workID"
                       label="工号"
                       align="left"
                       width="85">
  </el-table-column>
      <el-table-column
                       prop="birthday"
                       label="出生日期"
                       align="center"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="idCard"
                       label="身份证号码"
                       align="center"
                       width="150">
  </el-table-column>
      <el-table-column
                       prop="wedlock"
                       label="婚姻状况"
                       align="center"
                       width="70">
  </el-table-column>
      <el-table-column
                       prop="nation.name"
                       label="民族"
                       align="center"
                       width="50">
  </el-table-column>
      <el-table-column
                       prop="nativePlace"
                       label="籍贯"
                       align="left"
                       width="80">
  </el-table-column>
      <el-table-column
                       prop="politicsstatus.name"
                       align="center"
                       label="政治面貌">
  </el-table-column>
      <el-table-column
                       prop="email"
                       label="电子邮件"
                       align="left"
                       width="180">
  </el-table-column>
      <el-table-column
                       prop="phone"
                       label="电话号码"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="address"
                       label="联系地址"
                       align="left"
                       width="220">
  </el-table-column>
      <el-table-column
                       prop="department.name"
                       label="所属部门"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="position.name"
                       label="职位"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="jobLevel.name"
                       label="职称"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="engageForm"
                       label="聘用形式"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="beginDate"
                       label="入职日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="conversionTime"
                       label="转正日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="beginContract"
                       label="合同起始日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="endContract"
                       label="合同截止日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       label="合同期限"
                       align="left"
                       width="100">
        <template slot-scope="scope">
          <el-tag>{{scope.row.contractTerm}}</el-tag>
          年
</template>
</el-table-column>
<el-table-column
                 prop="tiptopDegree"
                 label="最高学历">
</el-table-column>
<el-table-column
                 fixed="right"
                 width="200"
                 label="操作">
  <template slot-scope="scope">
<el-button style="padding: 2px" size="mini">编辑</el-button>
<el-button style="padding: 2px" size="mini" type="primary">查看高级资料</el-button>
<el-button style="padding: 2px" size="mini" type="danger">删除</el-button>
  </template>
</el-table-column>
</el-table>
<div style="display: flex;justify-content: flex-end;">
  <el-pagination
                 @current-change="currentChange"
                 @size-change="sizeChange"
                 background
                 layout="sizes, prev, pager, next, jumper, ->, total, slot"
                 :total="total">
  </el-pagination>
</div>
</div>
<el-dialog
           title="添加员工"
           :visible.sync="dialogVisible"
           width="80%">

  <div>
    <el-form>
      <el-row>
        <el-col :span="6">
          <el-form-item label="姓名:" prop="name">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-edit"
                      v-model="emp.name" placeholder="请输入员工新名…"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="性别:" prop="gender">
            <el-radio-group v-model="emp.gender">
              <el-radio label="男">男</el-radio>
              <el-radio label="女">女</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="出生日期:" prop="birthday">
            <el-date-picker
                            v-model="emp.birthday"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 150px;"
                            placeholder="出生日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="政治面貌:" prop="politicId">
            <el-select v-model="emp.politicId" placeholder="政治面貌" size="mini" style="width: 200px;">
              <el-option
                         v-for="item in politicsstatus"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="6">
          <el-form-item label="民族:" prop="nationId">
            <el-select v-model="emp.nationId" placeholder="民族" size="mini" style="width: 200px;">
              <el-option
                         v-for="item in nations"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="籍贯:" prop="nativePlace">
            <el-input size="mini" style="width: 120px;" prefix-icon="el-icon-edit"
                      v-model="emp.nativePlace" placeholder="请输入籍贯"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="电子邮箱:" prop="email">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-message"
                      v-model="emp.email" placeholder="请输入邮箱"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="联系地址:" prop="address">
            <el-input size="mini" style="width: 200px;" prefix-icon="el-icon-edit"
                      v-model="emp.address" placeholder="请输入联系地址"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="6">
          <el-form-item label="职位:" prop="posId">
            <el-select v-model="emp.posId" placeholder="职位" size="mini" style="width: 150px;">
              <el-option
                         v-for="item in positions"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="职称:" prop="jobLevelId">
            <el-select v-model="emp.jobLevelId" placeholder="职称" size="mini" style="width: 150px;">
              <el-option
                         v-for="item in joblevels"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="所属部门:" prop="departmentId">
            <el-popover
                        placement="right"
                        title="请选择部门"
                        width="200"
                        trigger="manual"
                        v-model="popVisible">
              <el-tree :data="allDeps" default-expand-all :props="defaultProps"
                       @node-click="handleNodeClick"></el-tree>
              <div slot="reference" style="width: 150px;display: inline-flex;font-size: 13px;
                                           border: 1px solid #dedede; height: 26px;border-radius: 5px;cursor: pointer;
                                           align-items: center;padding-left: 8px;box-sizing: border-box" @click="showDepView">{{inputDepName}}</div>
            </el-popover>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="电话号码:" prop="phone">
            <el-input size="mini" style="width: 200px;" prefix-icon="el-icon-phone"
                      v-model="emp.phone" placeholder="电话号码"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="6">
          <el-form-item label="工号:" prop="workID">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-edit"
                      v-model="emp.workID" placeholder="工号" disabled></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="学历:" prop="tiptopDegree">
            <el-select v-model="emp.tiptopDegree" placeholder="学历" size="mini"
                       style="width: 150px;">
              <el-option
                         v-for="item in tiptopDegrees"
                         :key="item"
                         :label="item"
                         :value="item">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="毕业院校:" prop="school">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-edit"
                      v-model="emp.school" placeholder="毕业院校名称"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="专业名称:" prop="specialty">
            <el-input size="mini" style="width: 200px;" prefix-icon="el-icon-phone"
                      v-model="emp.specialty" placeholder="专业名称"></el-input>
          </el-form-item>
        </el-col>
      </el-row>

      <el-row>
        <el-col :span="6">
          <el-form-item label="入职日期:" prop="beginDate">
            <el-date-picker
                            v-model="emp.beginDate"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 130px;"
                            placeholder="入职日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="转正日期:" prop="conversionTime">
            <el-date-picker
                            v-model="emp.conversionTime"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 130px;"
                            placeholder="转正日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="合同起始日期:" prop="beginContract">
            <el-date-picker
                            v-model="emp.beginContract"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 130px;"
                            placeholder="合同起始日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="合同终止日期:" prop="endContract">
            <el-date-picker
                            v-model="emp.endContract"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 150px;"
                            placeholder="合同终止日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="8">
          <el-form-item label="身份证号码:" prop="idCard">
            <el-input size="mini" style="width: 180px;" prefix-icon="el-icon-edit"
                      v-model="emp.idCard" placeholder="请输入身份证号码"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="8">
          <el-form-item label="合同:" prop="engageForm">
            <el-radio-group v-model="emp.engageForm">
              <el-radio label="劳动合同">劳动合同</el-radio>
              <el-radio label="劳务合同">劳务合同</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
        <el-col :span="8">
          <el-form-item label="婚姻状况:" prop="wedlock">
            <el-radio-group v-model="emp.wedlock">
              <el-radio label="已婚">已婚</el-radio>
              <el-radio label="未婚">未婚</el-radio>
              <el-radio label="离异">离异</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
      </el-row>
    </el-form>
  </div>

  <span slot="footer" class="dialog-footer">
    <el-button @click="dialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="doAddEmp">确 定</el-button>
  </span>
</el-dialog>
</div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        emps: [],
        allDeps: [],
        loading: false,
        total: 0,
        page: 1,
        size: 10,
        keyword: '',
        dialogVisible: false,
        nations: [],
        joblevels: [],
        politicsstatus: [],
        positions: [],
        emp: {
          name: "rocketWizt",
          gender: "男",
          birthday: "1990-01-01",
          idCard: "610122199001011256",
          wedlock: "已婚",
          nationId: 1,
          nativePlace: "陕西",
          politicId: 13,
          email: "laowang@qq.com",
          phone: "18565558897",
          address: "深圳市南山区",
          departmentId: 5,
          jobLevelId: 9,
          posId: 29,
          engageForm: "劳务合同",
          tiptopDegree: "本科",
          specialty: "信息管理与信息系统",
          school: "深圳大学",
          beginDate: "2018-01-01",
          workState: "在职",
          workID: "00000070",
          contractTerm: 2.0,
          conversionTime: "2018-04-01",
          notworkDate: null,
          beginContract: "2018-01-01",
          endContract: "2020-01-01",
          workAge: null
        },
        tiptopDegrees: ['本科', '大专', '硕士', '博士', '高中', '初中', '小学', '其他'],
        popVisible: false,
        defaultProps: {
          children: 'children',
          label: 'name'
        },
        inputDepName: ''
      }
    },
    mounted() {
      this.initEmps()
      this.initData()
    },
    methods: {
      initPositions() {
        this.getRequest("/emp/basic/positions").then(res => {
          if (res) {
            this.positions = res
          }
        })
      },
      initData() {
        if (!window.sessionStorage.getItem("nations")) {
          this.getRequest("/emp/basic/nations").then(res => {
            if (res) {
              this.nations = res
              window.sessionStorage.setItem("nations", JSON.stringify(res))
            }
          })
        } else {
          this.nations = JSON.parse(window.sessionStorage.getItem("nations"))
        }
        if (!window.sessionStorage.getItem("politicsstatus")) {
          this.getRequest("/emp/basic/politicsstatus").then(res => {
            if (res) {
              this.politicsstatus = res
              window.sessionStorage.setItem("politicsstatus", JSON.stringify(res))
            }
          })
        } else {
          this.politicsstatus = JSON.parse(window.sessionStorage.getItem("politicsstatus"))
        }
        if (!window.sessionStorage.getItem("joblevels")) {
          this.getRequest("/emp/basic/jobLevels").then(res => {
            if (res) {
              this.joblevels = res
              window.sessionStorage.setItem("joblevels", JSON.stringify(res))
            }
          })
        } else {
          this.joblevels = JSON.parse(window.sessionStorage.getItem("joblevels"))
        }
        if (!window.sessionStorage.getItem("allDeps")) {
          this.getRequest("/emp/basic/deps").then(res => {
            if (res) {
              this.allDeps = res
              window.sessionStorage.setItem("allDeps", JSON.stringify(res))
            }
          })
        } else {
          this.allDeps = JSON.parse(window.sessionStorage.getItem("allDeps"))
          console.log(this.allDeps);
        }
      },
      initEmps() {
        this.loading = true
        this.getRequest("/emp/basic/?page=" + this.page + "&size=" + this.size + "&keyword=" + this.keyword).then(res => {
          this.loading = false
          if (res) {
            this.total = res.total
            this.emps = res.data
          }
        })
      },
      // 页发生变化
      currentChange(currentPage) {
        this.page = currentPage;
        this.initEmps()
      },
      // 条数发生变化
      sizeChange(currentSize) {
        this.size = currentSize;
        this.initEmps()
      },
      // 添加员工的弹出框
      showAddEmpView() {
        this.dialogVisible = true
        this.initPositions()
        this.getMaxWorkID()
      },
      getMaxWorkID() {
        this.getRequest("/emp/basic/maxWorkID").then(res => {
          if (res) {
            this.emp.workId = res.Obj
          }
        })
      },
      // 所属部门点击打开弹出窗
      showDepView() {
        this.popVisible = !this.popVisible
      },
      // 树的点击事件
      handleNodeClick(data) {
        this.popVisible = !this.popVisible
        this.emp.departmentId = data.id
        this.inputDepName = data.name
      },
      // 添加员工的确认按钮
      doAddEmp(){
        this.postRequest("/emp/basic/",this.emp).then(res=>{
          if (res){
            this.dialogVisible = false
            this.initEmps()
          }
        })
      }
    }
  }
</script>
```

## 1.6. 前端 - 对添加员工功能进行校验

步骤：

* from 标签中添加三个属性 `model` : 数据对象，`rules` : 校验规则，`ref` : 实例对象名称
* 在点击添加按钮时添加一个判断 `this.$refs.empForm.visible` 进行校验

```vue
<template>
<div>
  <el-dialog
             title="添加员工"
             :visible.sync="dialogVisible"
             width="80%">

    <div>
      <!-- 添加员工的表单 -->
      <el-form :model="emp" :rules="empRules" ref="empForm">
  </el-form>
  </el-dialog>
  </div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        emp: {
          name: "rocketWizt",
          gender: "男",
          birthday: "1990-01-01",
          idCard: "610122199001011256",
          wedlock: "已婚",
          nationId: 1,
          nativePlace: "陕西",
          politicId: 13,
          email: "laowang@qq.com",
          phone: "18565558897",
          address: "深圳市南山区",
          departmentId: null,
          jobLevelId: 9,
          posId: 29,
          engageForm: "劳务合同",
          tiptopDegree: "本科",
          specialty: "信息管理与信息系统",
          school: "深圳大学",
          beginDate: "2018-01-01",
          workState: "在职",
          workID: "00000070",
          contractTerm: 2.0,
          conversionTime: "2018-04-01",
          notworkDate: null,
          beginContract: "2018-01-01",
          endContract: "2020-01-01",
          workAge: null
        },
        // 校验规则
        empRules: {
          name: [{required: true, message: '请输入用户名', trigger: 'blur'}],
          gender: [{required: true, message: '请选择性别', trigger: 'blur'}],
          birthday: [{required: true, message: '请输入出生日期', trigger: 'blur'}],
          idCard: [{
            required: true,
            message: '请输入身份证号码',
            trigger: 'blur'
          }, {
            pattern: /^[1-9]\\d{5}(18|19|20)\\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$/,
            message: '身份证号码格式不正确',
            trigger: 'blur'
          }],
          wedlock: [{required: true, message: '请选择婚姻状况', trigger: 'blur'}],
          nationId: [{required: true, message: '请选择民族', trigger: 'blur'}],
          nativePlace: [{required: true, message: '请输入籍贯', trigger: 'blur'}],
          politicId: [{required: true, message: '请选择政治面貌', trigger: 'blur'}],
          email: [{
            required: true,
            message: '请输入邮箱',
            trigger: 'blur'
          }, {
            type: 'email',
            message: '邮箱格式不正确',
            trigger: 'blur'
          }],
          phone: [{required: true, message: '请输入手机号码', trigger: 'blur'}],
          address: [{required: true, message: '请输入员工地址', trigger: 'blur'}],
          departmentId: [{required: true, message: '请选择部门名称', trigger: 'blur'}],
          jobLevelId: [{required: true, message: '请选择职称', trigger: 'blur'}],
          posId: [{required: true, message: '请选择职位', trigger: 'blur'}],
          engageForm: [{required: true, message: '请选择聘用形式', trigger: 'blur'}],
          tiptopDegree: [{required: true, message: '请输入学位', trigger: 'blur'}],
          specialty: [{required: true, message: '请输入专业', trigger: 'blur'}],
          school: [{required: true, message: '请输入毕业院校', trigger: 'blur'}],
          beginDate: [{required: true, message: '请输入入职日期', trigger: 'blur'}],
          workState: [{required: true, message: '请输入工作状况', trigger: 'blur'}],
          workID: [{required: true, message: '请输入工号', trigger: 'blur'}],
          contractTerm: [{required: true, message: '请输入合同期限', trigger: 'blur'}],
          conversionTime: [{required: true, message: '请输入转正日期', trigger: 'blur'}],
          notworkDate: [{required: true, message: '请输入离职日期', trigger: 'blur'}],
          beginContract: [{required: true, message: '请输入合同起始日期', trigger: 'blur'}],
          endContract: [{required: true, message: '请输入合同结束日期', trigger: 'blur'}],
          workAge: [{required: true, message: '请输入工龄', trigger: 'blur'}],
        }
      }
    },
    methods: {
      // 添加员工的确认按钮
      doAddEmp() {
        // 进行校验
        this.$refs.empForm.visible(valid => {
          if (valid) {
            this.postRequest("/emp/basic/", this.emp).then(res => {
              if (res) {
                this.dialogVisible = false
                this.initEmps()
              }
            })
          }
        })
      }
    }
  }
</script>
```

## 1.7. 后端 - 添加员工时计算合同期限

通过使用 `SimpleDateFormat` 和 `DecimalFormat` 来进行格式化 合同起始日期、合同结束日期 然后通过删减得出 合同期限

* 格式化合同起始日期、合同结束日期格式出 yyyy 互减后乘12，得出月份
* 格式化合同起始日期、合同结束日期格式出 MM 互减后，然后和前面的月份相加
* 将总月份 `÷12` 然后使用 `DecimalFormat` 来格式化数据，将数据格式成 ##.00 的形式

```java
@Service
public class EmployeeService {

  @Autowired
  EmployeeMapper employeeMapper;

  SimpleDateFormat yearFormat = new SimpleDateFormat("yyyy");
  SimpleDateFormat monthFormat = new SimpleDateFormat("MM");
  DecimalFormat decimalFormat = new DecimalFormat("##.00");

  public Integer addEmp(Employee employee) {
    // 在添加员工的时候将合同期限计算出来，并存入数据库
    Date beginContract = employee.getBeginContract();
    Date endContract = employee.getEndContract();
    double month = (Double.parseDouble(yearFormat.format(endContract)) - Double.parseDouble(yearFormat.format(beginContract))) * 12
      + (Double.parseDouble(monthFormat.format(endContract)) - Double.parseDouble(monthFormat.format(beginContract)));

    employee.setContractTerm(Double.parseDouble(decimalFormat.format(month/12)));

    return employeeMapper.insertSelective(employee);
  }
```

## 1.8. 前后端 - 数据导出成 Excel、文件下载

Java操作 excel 有几种方法，常见的就有

* 阿里巴巴的 `easyexcel` 
* 阿帕奇的 `poi`

这里使用 `poi` 来操作 Excel

```xml
<!-- https://mvnrepository.com/artifact/org.apache.poi/poi -->
<dependency>
  <groupId>org.apache.poi</groupId>
  <artifactId>poi</artifactId>
  <version>4.1.2</version>
</dependency>
```

Controller 层

```java
@RestController
@RequestMapping("/employee/basic")
public class EmpBasicController {

    @Autowired
    EmployeeService employeeService;
  
    // Excel操作：导出
    @GetMapping("/export")
    public ResponseEntity<byte[]> exportData(){
        List<Employee> list = (List<Employee>) employeeService.getEmployeeByPage(null,null,null).getData();
        return POIUtils.employee2Excel(list);
    }
}
```

创建一个工具类用来将查询总数放在 Excel 文件中

* HSSFWorkbook : Excel 文档
* DocumentSummaryInformation : 文档信息
* SummaryInformation : 文档摘要信息
* HSSFCellStyle : 单元格样式
* HSSFSheet : Excel 中的一页工作表
* HSSFRow : 行
* HSSFCell : 单元格

```java
public class POIUtils {
  public static ResponseEntity<byte[]> employee2Excel(List<Employee> list) {
    // 1、创建一个 Excel 文档
    HSSFWorkbook workbook = new HSSFWorkbook();

    // 2、创建文档摘要 配置文档的基本信息。eg：Excel文件的标记、类别、状态、类型、主题、备注……
    workbook.createInformationProperties();

    // 3、获取并配置文档信息
    DocumentSummaryInformation docInfo = new DocumentSummaryInformation();
    // 文档类别
    docInfo.setCategory("员工信息");
    // 文档管理员
    docInfo.setManager("ChangingTao");
    // 设置公司信息
    docInfo.setCompany("www.ChangingTao.com");

    // 4、获取并配置文档摘要信息
    SummaryInformation summInfo = workbook.getSummaryInformation();
    // 文档标题
    summInfo.setTitle("员工信息表");
    // 文档作者
    summInfo.setAuthor("ChangingTao");
    // 文档备注
    summInfo.setComments("本文由 ChangingTao 提供");

    // 5、创建样式
    HSSFCellStyle hssfCellStyle = workbook.createCellStyle();
    // 创建标题行的样式：背景颜色:黄色、填充模式:铺满
    hssfCellStyle.setFillForegroundColor(IndexedColors.YELLOW.getIndex());
    hssfCellStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);
    // 日期格式化
    HSSFCellStyle dateCellStyle = workbook.createCellStyle();
    dateCellStyle.setDataFormat(HSSFDataFormat.getBuiltinFormat("m/d/yy"));

    // 6、创建工作表
    HSSFSheet sheet = workbook.createSheet("员工信息表");
    // 设置列的宽度
    sheet.setColumnWidth(0, 5 * 256);
    sheet.setColumnWidth(1, 12 * 256);
    sheet.setColumnWidth(2, 10 * 256);
    sheet.setColumnWidth(3, 5 * 256);
    sheet.setColumnWidth(4, 12 * 256);
    sheet.setColumnWidth(5, 20 * 256);
    sheet.setColumnWidth(6, 10 * 256);
    sheet.setColumnWidth(7, 10 * 256);
    sheet.setColumnWidth(8, 16 * 256);
    sheet.setColumnWidth(9, 12 * 256);
    sheet.setColumnWidth(10, 15 * 256);
    sheet.setColumnWidth(11, 20 * 256);
    sheet.setColumnWidth(12, 16 * 256);
    sheet.setColumnWidth(13, 14 * 256);
    sheet.setColumnWidth(14, 14 * 256);
    sheet.setColumnWidth(15, 12 * 256);
    sheet.setColumnWidth(16, 8 * 256);
    sheet.setColumnWidth(17, 20 * 256);
    sheet.setColumnWidth(18, 20 * 256);
    sheet.setColumnWidth(19, 12 * 256);
    sheet.setColumnWidth(20, 8 * 256);
    sheet.setColumnWidth(21, 25 * 256);
    sheet.setColumnWidth(22, 14 * 256);
    sheet.setColumnWidth(23, 15 * 256);
    sheet.setColumnWidth(24, 15 * 256);
    // 创建标题行
    HSSFRow r0 = sheet.createRow(0);
    // 创建单元格
    HSSFCell c0 = r0.createCell(0);
    HSSFCell c1 = r0.createCell(1);
    HSSFCell c2 = r0.createCell(2);
    HSSFCell c3 = r0.createCell(3);
    HSSFCell c4 = r0.createCell(4);
    HSSFCell c5 = r0.createCell(5);
    HSSFCell c6 = r0.createCell(6);
    HSSFCell c7 = r0.createCell(7);
    HSSFCell c8 = r0.createCell(8);
    HSSFCell c9 = r0.createCell(9);
    HSSFCell c10 = r0.createCell(10);
    HSSFCell c11 = r0.createCell(11);
    HSSFCell c12 = r0.createCell(12);
    HSSFCell c13 = r0.createCell(13);
    HSSFCell c14 = r0.createCell(14);
    HSSFCell c15 = r0.createCell(15);
    HSSFCell c16 = r0.createCell(16);
    HSSFCell c17 = r0.createCell(17);
    HSSFCell c18 = r0.createCell(18);
    HSSFCell c19 = r0.createCell(19);
    HSSFCell c20 = r0.createCell(20);
    HSSFCell c21 = r0.createCell(21);
    HSSFCell c22 = r0.createCell(22);
    HSSFCell c23 = r0.createCell(23);
    HSSFCell c24 = r0.createCell(24);
    // 列样式
    c0.setCellStyle(hssfCellStyle);
    c1.setCellStyle(hssfCellStyle);
    c2.setCellStyle(hssfCellStyle);
    c3.setCellStyle(hssfCellStyle);
    c4.setCellStyle(hssfCellStyle);
    c5.setCellStyle(hssfCellStyle);
    c6.setCellStyle(hssfCellStyle);
    c7.setCellStyle(hssfCellStyle);
    c8.setCellStyle(hssfCellStyle);
    c9.setCellStyle(hssfCellStyle);
    c10.setCellStyle(hssfCellStyle);
    c11.setCellStyle(hssfCellStyle);
    c12.setCellStyle(hssfCellStyle);
    c13.setCellStyle(hssfCellStyle);
    c14.setCellStyle(hssfCellStyle);
    c15.setCellStyle(hssfCellStyle);
    c16.setCellStyle(hssfCellStyle);
    c17.setCellStyle(hssfCellStyle);
    c18.setCellStyle(hssfCellStyle);
    c19.setCellStyle(hssfCellStyle);
    c20.setCellStyle(hssfCellStyle);
    c21.setCellStyle(hssfCellStyle);
    c22.setCellStyle(hssfCellStyle);
    c23.setCellStyle(hssfCellStyle);
    c24.setCellStyle(hssfCellStyle);
    // 单元格名(列名)
    c0.setCellValue("编号");
    c1.setCellValue("姓名");
    c2.setCellValue("工号");
    c3.setCellValue("性别");
    c4.setCellValue("出生日期");
    c5.setCellValue("身份证号码");
    c6.setCellValue("婚姻状况");
    c7.setCellValue("民族");
    c8.setCellValue("籍贯");
    c9.setCellValue("政治面貌");
    c10.setCellValue("电话号码");
    c11.setCellValue("联系地址");
    c12.setCellValue("所属部门");
    c13.setCellValue("职位");
    c14.setCellValue("职称");
    c15.setCellValue("聘用形式");
    c16.setCellValue("最高学历");
    c17.setCellValue("专业");
    c18.setCellValue("毕业院校");
    c19.setCellValue("入职日期");
    c20.setCellValue("在职状态");
    c21.setCellValue("邮箱");
    c22.setCellValue("合同期限(年)");
    c23.setCellValue("合同起始日期");
    c24.setCellValue("合同终止日期");

    // 给列赋值
    for (int i = 0; i < list.size(); i++) {
      Employee emp = list.get(i);
      HSSFRow row = sheet.createRow(i + 1);
      row.createCell(0).setCellValue(emp.getId());
      row.createCell(1).setCellValue(emp.getName());
      row.createCell(2).setCellValue(emp.getWorkID());
      row.createCell(3).setCellValue(emp.getGender());
      HSSFCell cell4 = row.createCell(4);
      cell4.setCellValue(emp.getBirthday());
      cell4.setCellStyle(dateCellStyle);
      row.createCell(5).setCellValue(emp.getIdCard());
      row.createCell(6).setCellValue(emp.getWedlock());
      row.createCell(7).setCellValue(emp.getNation().getName());
      row.createCell(8).setCellValue(emp.getNativePlace());
      row.createCell(9).setCellValue(emp.getPoliticsstatus().getName());
      row.createCell(10).setCellValue(emp.getPhone());
      row.createCell(11).setCellValue(emp.getAddress());
      row.createCell(12).setCellValue(emp.getDepartment().getName());
      row.createCell(13).setCellValue(emp.getJobLevel().getName());
      row.createCell(14).setCellValue(emp.getPosition().getName());
      row.createCell(15).setCellValue(emp.getEngageForm());
      row.createCell(16).setCellValue(emp.getTiptopDegree());
      row.createCell(17).setCellValue(emp.getSpecialty());
      row.createCell(18).setCellValue(emp.getSchool());
      HSSFCell cell19 = row.createCell(19);
      cell19.setCellValue(emp.getBeginDate());
      cell19.setCellStyle(dateCellStyle);
      row.createCell(20).setCellValue(emp.getWorkState());
      row.createCell(21).setCellValue(emp.getEmail());
      row.createCell(22).setCellValue(emp.getContractTerm());
      HSSFCell cell23 = row.createCell(23);
      cell23.setCellValue(emp.getBeginContract());
      cell23.setCellStyle(dateCellStyle);
      HSSFCell cell24 = row.createCell(24);
      cell24.setCellValue(emp.getEndContract());
      cell24.setCellStyle(dateCellStyle);
      HSSFCell cell25 = row.createCell(25);
      cell25.setCellValue(emp.getConversionTime());
      cell25.setCellStyle(dateCellStyle);
    }

    // workbook 转化为数组
    ByteArrayOutputStream baos = new ByteArrayOutputStream();
    // 设置请求头
    HttpHeaders headers = new HttpHeaders();
    try {
      // 将文件进行转码（支持中文）
      headers.setContentDispositionFormData("attachment", new String("员工表.xls".getBytes("UTF-8"), "ISO-8859-1"));
      // 定义网络文件的类型和网页的编码，这里告诉浏览器返回的是二进制流数据
      headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);
      // 转换为字节流
      workbook.write(baos);
    } catch (IOException e) {
      e.printStackTrace();
    }
    // ResponseEntity参数：流数据、请求头、状态码
    return new ResponseEntity<byte[]>(baos.toByteArray(), headers, HttpStatus.CREATED);
  }
```

写成文件：

```java
ByteArrayOutputStream baos = new ByteArrayOutputStream();
workbook.write(baos);
```

---

前端：

* 给导出文件添加点击事件 `exportData()`
* 通过 `window.open` 的方式获取Excel文件

```js
// 导出Excel
exportData(){
  window.open('/employee/basic/export', '_parent')
}
```

## 1.9 前后端 - Excel文件上传、解析Excel执行更新操作

前端：

文件上传有两种方式：

* element 的 Update 组件
* Ajax

这里使用 element 的 Update 组件进行上传

```vue
<template>
<div>
  <!-- 文件上传组件 -->
  <el-upload
             style="display: inline-flex; margin-right: 8px;"
             action="/employee/basic/import"
             :show-file-list="false"
             :before-upload="beforeUpload"
             :on-success="onSuccess"
             :on-error="onError"
             :disabled="importDataDisable">
    <el-button :disabled="importDataDisable" type="success" :icon="importDataBtnIcon">
      {{importDataBtnText}}
  </el-button>
  </el-upload>
  </div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        importDataBtnText: '导入数据',
        importDataBtnIcon: 'el-icon-upload2',
        importDataDisable: false,
      },
    }
      methods: {
        // 上传成功
        onSuccess(response, file, fileList) {
          this.importDataBtnText = '导入数据'
          this.importDataBtnIcon = 'el-icon-upload2'
          this.importDataDisable = false
          this.initEmps()
        },
          // 上传失败
          onError() {
            this.importDataBtnText = '导入数据'
            this.importDataBtnIcon = 'el-icon-upload2'
            this.importDataDisable = false
          },
            // 上传之前
            beforeUpload() {
              this.importDataBtnText = '正在导入'
              this.importDataBtnIcon = 'el-icon-loading'
              this.importDataDisable = true
            }
      }
    }
</script>
```

---

后端：

接口

* 文件上传时获取文件，创建一个POI 工具类，参数：文件、民族列表、政治面貌列表、职称列表、职位列表、所属部门列表，用于解析Excel并且通过 equles 判断是哪个信息，将ID赋值

```java
@RestController
@RequestMapping("/employee/basic")
public class EmpBasicController {

  @Autowired
  EmployeeService employeeService;
  // Excel操作：文件上传
  @PostMapping("/import")
  public RespBean importData(MultipartFile file) throws IOException {
    List<Employee> list = POIUtils.excel2Employee(
      file,
      nationService.getAllNations(),
      politicsstatusService.getAllPoliticsstatus(),
      departmentService.getAllDepartmentWithOutChildren(),
      positionService.getAllPositions(),
      jobLevelService.getAllJobLevels());
    if(employeeService.addEmps(list) == list.size()){
      return RespBean.ok("插入成功！");
    }
    //        file.transferTo(new File("E:\\javaboy.xls"));
    return RespBean.ok("插入失败！");
  }
}
```

POI解析文件工具类：

```java
public class POIUtils {
  /**
     * Excel 解析成员工集合
     *
     * @param file
     * @param allNations        民族
     * @param allPoliticsstatus 政治面貌 
     * @param allDepartments 部门
     * @param allPositions	职位
     * @param allJobLevels	职称
     * @return
     */
  public static List<Employee> excel2Employee(MultipartFile file, List<Nation> allNations, List<Politicsstatus> allPoliticsstatus, List<Department> allDepartments, List<Position> allPositions, List<JobLevel> allJobLevels) {
    List<Employee> list = new ArrayList<>();
    Employee employee = null;
    try {
      // 1、创建一个workbook对象，获取文件流
      HSSFWorkbook workbook = new HSSFWorkbook(file.getInputStream());
      // 2、获取Excel文件表单的长度
      int numberOfSheets = workbook.getNumberOfSheets();
      for (int i = 0; i < numberOfSheets; i++) {
        // 3、获取表单
        HSSFSheet sheet = workbook.getSheetAt(i);
        // 4、获取表单中的行数
        int physicalNumberOfRows = sheet.getPhysicalNumberOfRows();
        for (int j = 0; j < physicalNumberOfRows; j++) {
          // 5、跳过标题行
          if (j == 0) {
            continue; // 跳过解析标题行
          }
          // 6、获取行
          HSSFRow row = sheet.getRow(j);
          if (row == null) {
            continue; // 防止数据中间有空行
          }
          // 7、获取列
          int physicalNumberOfCells = row.getPhysicalNumberOfCells();
          employee = new Employee();
          // 循环单列，将单列的信息存储到 employee 对象中，并添加到list集合中
          for (int k = 0; k < physicalNumberOfCells; k++) {
            HSSFCell cell = row.getCell(k);
            switch (cell.getCellType()) {
                // 如果单行格是字符串
              case STRING:
                String cellValue = cell.getStringCellValue();
                switch (k) {
                    /* 解析：这里通过 case 来选择对应的列数，然后动态的通过employee.setxxx() 进行赋值（民族、政治面貌……通过indexof返回索引值确认其id（通过id插入值，所以只需要传入id）） */
                  case 1:
                    employee.setName(cellValue);
                    break;
                  case 2:
                    employee.setWorkID(cellValue);
                    break;
                  case 3:
                    employee.setGender(cellValue);
                    break;
                  case 5:
                    employee.setIdCard(cellValue);
                    break;
                  case 6:
                    employee.setWedlock(cellValue);
                    break;
                  case 7:
                    int nationIndex = allNations.indexOf(new Nation(cellValue));
                    employee.setNationId(allNations.get(nationIndex).getId());
                    break;
                  case 8:
                    employee.setNativePlace(cellValue);
                    break;
                  case 9:
                    int politicstatusIndex = allPoliticsstatus.indexOf(new Politicsstatus(cellValue));
                    employee.setPoliticId(allPoliticsstatus.get(politicstatusIndex).getId());
                    break;
                  case 10:
                    employee.setPhone(cellValue);
                    break;
                  case 11:
                    employee.setAddress(cellValue);
                    break;
                  case 12:
                    int departmentIndex = allDepartments.indexOf(new Department(cellValue));
                    employee.setDepartmentId(allDepartments.get(departmentIndex).getId());
                    break;
                  case 13:
                    int jobLevelIndex = allJobLevels.indexOf(new JobLevel(cellValue));
                    employee.setJobLevelId(allJobLevels.get(jobLevelIndex).getId());
                    break;
                  case 14:
                    int positionIndex = allPositions.indexOf(new Position(cellValue));
                    employee.setPosId(allPositions.get(positionIndex).getId());
                    break;
                  case 15:
                    employee.setEngageForm(cellValue);
                    break;
                  case 16:
                    employee.setTiptopDegree(cellValue);
                    break;
                  case 17:
                    employee.setSpecialty(cellValue);
                    break;
                  case 18:
                    employee.setSchool(cellValue);
                    break;
                  case 20:
                    employee.setWorkState(cellValue);
                    break;
                  case 21:
                    employee.setEmail(cellValue);
                    break;
                }
                break;
                // 如果不是字符串信息，则说明为日期
              default: {
                switch (k) {
                  case 4:
                    employee.setBirthday(cell.getDateCellValue());
                    break;
                  case 19:
                    employee.setBeginDate(cell.getDateCellValue());
                    break;
                  case 22:
                    employee.setContractTerm(cell.getNumericCellValue());
                    break;
                  case 23:
                    employee.setBeginContract(cell.getDateCellValue());
                    break;
                  case 24:
                    employee.setEndContract(cell.getDateCellValue());
                    break;
                  case 25:
                    employee.setConversionTime(cell.getDateCellValue());
                    break;
                }
              }
                break;
            }
          }
          list.add(employee);
        }
      }
    } catch (IOException e) {
      e.printStackTrace();
    }
    return list;
  }
}
```

Service 层

```java
@Service
public class EmployeeService {
  @Autowired
  EmployeeMapper employeeMapper; 
  public Integer addEmps(List<Employee> list) {
    return employeeMapper.addEmps(list);
  }
}
```

Mapper层

```xml
<insert id="addEmps">
  insert into employee (name, gender,
  birthday, idCard, wedlock, nationId,
  nativePlace, politicId, email,
  phone, address, departmentId,
  jobLevelId, posId, engageForm,
  tiptopDegree, specialty, school,
  beginDate, workState, workID,
  contractTerm, conversionTime, notWorkDate,
  beginContract, endContract, workAge
  )
  values
  <foreach collection="list" item="emp" separator=",">
    (#{emp.name,jdbcType=VARCHAR}, #{emp.gender,jdbcType=CHAR},
    #{emp.birthday,jdbcType=DATE}, #{emp.idCard,jdbcType=CHAR}, #{emp.wedlock,jdbcType=CHAR},
    #{emp.nationId,jdbcType=INTEGER},
    #{emp.nativePlace,jdbcType=VARCHAR}, #{emp.politicId,jdbcType=INTEGER}, #{emp.email,jdbcType=VARCHAR},
    #{emp.phone,jdbcType=VARCHAR}, #{emp.address,jdbcType=VARCHAR}, #{emp.departmentId,jdbcType=INTEGER},
    #{emp.jobLevelId,jdbcType=INTEGER}, #{emp.posId,jdbcType=INTEGER}, #{emp.engageForm,jdbcType=VARCHAR},
    #{emp.tiptopDegree,jdbcType=CHAR}, #{emp.specialty,jdbcType=VARCHAR}, #{emp.school,jdbcType=VARCHAR},
    #{emp.beginDate,jdbcType=DATE}, #{emp.workState,jdbcType=CHAR}, #{emp.workID,jdbcType=CHAR},
    #{emp.contractTerm,jdbcType=DOUBLE}, #{emp.conversionTime,jdbcType=DATE}, #{emp.notWorkDate,jdbcType=DATE},
    #{emp.beginContract,jdbcType=DATE}, #{emp.endContract,jdbcType=DATE}, #{emp.workAge,jdbcType=INTEGER}
    )
  </foreach>
</insert>
```

## 2.0. 前后端 - 高级搜索

前端：

* 当点击高级搜索的时候，搜索按钮、搜索输入框为禁用
* 点击高级搜索，将高级搜索框表单呈现出来，使用了Vue中的动画，淡出淡入
* 搜索、高级搜素共用 `initEmps()`。给加载员工信息的方法 `initEmps()` 加多了个判断，判断是高级搜索还是搜索

```vue
<template>
<div>
  <div>
    <div style="display: flex;justify-content: space-between">
      <!-- 左边搜索框 -->
      <div>
        <el-input placeholder="请输入员工名进行搜索，可以直接回车搜索…" prefix-icon="el-icon-search"
                  style="width: 350px;margin-right: 10px;" v-model="keyword"
                  @keydown.enter.native="initEmps"
                  clearable @clear="initEmps" :disabled="showAdvanceSearchView"></el-input>
        <el-button icon="el-icon-search" type="primary" @click="initEmps" :disabled="showAdvanceSearchView">
          搜索
  </el-button>
        <el-button type="primary" @click="showAdvanceSearchView = !showAdvanceSearchView">
          <i :class="showAdvanceSearchView ? 'fa fa-angle-double-up': 'fa fa-angle-double-down'"
             aria-hidden="true"></i>
          高级搜索
  </el-button>
  </div>
  </div>
  </div>
  <!-- 高级搜索 -->
  <transition name="slide-fade">
    <div v-show="showAdvanceSearchView"
         style="border: 1px solid #409eff;border-radius: 5px;box-sizing: border-box;padding: 5px;margin: 10px 0px;">
      <el-row>
        <el-col :span="5">
          政治面貌:
          <el-select v-model="searchValue.politicId" placeholder="政治面貌" size="mini"
                     style="width: 130px;">
            <el-option
                       v-for="item in politicsstatus"
                       :key="item.id"
                       :label="item.name"
                       :value="item.id">
  </el-option>
  </el-select>
  </el-col>
        <el-col :span="4">
          民族:
          <el-select v-model="searchValue.nationId" placeholder="民族" size="mini"
                     style="width: 150px;">
            <el-option
                       v-for="item in nations"
                       :key="item.id"
                       :label="item.name"
                       :value="item.id">
  </el-option>
  </el-select>
  </el-col>
        <el-col :span="4">
          职位:
          <el-select v-model="searchValue.posId" placeholder="职位" size="mini" style="width: 130px;">
            <el-option
                       v-for="item in positions"
                       :key="item.id"
                       :label="item.name"
                       :value="item.id">
  </el-option>
  </el-select>
  </el-col>
        <el-col :span="4">
          职称:
          <el-select v-model="searchValue.jobLevelId" placeholder="职称" size="mini"
                     style="width: 130px;">
            <el-option
                       v-for="item in joblevels"
                       :key="item.id"
                       :label="item.name"
                       :value="item.id">
  </el-option>
  </el-select>
  </el-col>
        <el-col :span="7">
          聘用形式:
          <el-radio-group v-model="searchValue.engageForm">
            <el-radio label="劳动合同">劳动合同</el-radio>
            <el-radio label="劳务合同">劳务合同</el-radio>
  </el-radio-group>
  </el-col>
  </el-row>
      <el-row style="margin-top: 10px;">
        <el-col :span="5">
          所属部门:
          <el-popover
                      placement="right"
                      title="请选择部门"
                      width="200"
                      trigger="manual"
                      v-model="popVisible">
            <el-tree :data="allDeps" default-expand-all :props="defaultProps"
                     @node-click="searchViewHandleNodeClick"></el-tree>
            <div slot="reference" style="width: 130px;display: inline-flex;font-size: 13px;
                                         border: 1px solid #dedede; height: 26px;border-radius: 5px;cursor: pointer;
                                         align-items: center;padding-left: 8px;box-sizing: border-box;margin-left: 3px;"
                 @click="showDepView">
              {{inputDepName}}
  </div>
  </el-popover>
  </el-col>
        <el-col :span="10">
          入职日期:
          <el-date-picker
                          v-model="searchValue.beginDateScope"
                          type="daterange"
                          size="mini"
                          unlink-panels
                          value-format="yyyy-MM-dd"
                          range-separator="至"
                          start-placeholder="开始日期"
                          end-placeholder="结束日期">
  </el-date-picker>
  </el-col>
        <el-col :span="5" :offset="4">
          <el-button size="mini">取消</el-button>
          <el-button size="mini" icon="el-icon-search" type="primary" @click="initEmps('advanced')">搜索
  </el-button>
  </el-col>
  </el-row>
  </div>
  </transition>
  </div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        // 是否展示高级搜索框
        showAdvanceSearchView: false,
        // 高级搜索存值对象
        searchValue: {
          politicId: null,
          nationId: null,
          jobLevelId: null,
          posId: null,
          engageForm: null,
          departmentId: null,
          beginDateScope: null
        },
      }
    },
    methods: {
      initEmps(type) {
        this.loading = true
        let url = '/employee/basic/?page=' + this.page + '&size=' + this.size;
        // 如果类型是高级搜索则使用高级搜索请求，否则则使用普通搜索请求
        if (type && type == 'advanced') {
          // 高级搜索中需要判断：如果存在值就添加这个查询字段，如果不存在就不添加
          if (this.searchValue.politicId) {
            url += '&politicId=' + this.searchValue.politicId;
          }
          if (this.searchValue.nationId) {
            url += '&nationId=' + this.searchValue.nationId;
          }
          if (this.searchValue.jobLevelId) {
            url += '&jobLevelId=' + this.searchValue.jobLevelId;
          }
          if (this.searchValue.posId) {
            url += '&posId=' + this.searchValue.posId;
          }
          if (this.searchValue.engageForm) {
            url += '&engageForm=' + this.searchValue.engageForm;
          }
          if (this.searchValue.departmentId) {
            url += '&departmentId=' + this.searchValue.departmentId;
          }
          if (this.searchValue.beginDateScope) {
            url += '&beginDateScope=' + this.searchValue.beginDateScope;
          }
        } else {
          url +=  "&name=" + this.keyword
        }
        this.getRequest(url).then(res => {
          this.loading = false
          if (res) {
            this.total = res.total
            this.emps = res.data
          }
        })
      },
      // 高级输入框的树点击事件（所属部门）
      searchViewHandleNodeClick(data){
        this.popVisible = !this.popVisible
        this.emp.departmentId = data.id
        this.inputDepName = data.name
      }
    }
  }
</script>

<style scoped>
  /* 可以设置不同的进入和离开动画 */
  /* 设置持续时间和动画函数 */
  .slide-fade-enter-active {
    transition: all .8s ease;
  }

  .slide-fade-leave-active {
    transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);
  }

  .slide-fade-enter, .slide-fade-leave-to
  /* .slide-fade-leave-active for below version 2.1.8 */
  {
    transform: translateX(10px);
    opacity: 0;
  }
</style>
```

---

后端：

Controller 层

* 修改了原来的 `getEmployeeByPage` 方法，删除 keywords ，添加 Employee，beginDateScope
* 这里需要注意，前端返回的 beginDateScope 是字符串形式的数组，但又是用来描述时间，所以我们需要添加转换器，将字符串转换为时间格式

```java
@RestController
@RequestMapping("/employee/basic")
public class EmpBasicController {

  @Autowired
  EmployeeService employeeService;
  // 获取所有员工信息（带有分页功能）
  @GetMapping("/")
  public RespPageBean getEmployeeByPage(@RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "10") Integer size,
                                        Employee employee, Date[] beginDateScope) {
    return employeeService.getEmployeeByPage(page, size, employee, beginDateScope);
  }
}
```

日期转换器 DateConverter

* 通过接口 `Converter<String, Date>` 将字符串转换为时间，注册后，接收数据就可以修改成为 Date 类型，不会出现报错

```java
@Component
public class DateConverter implements Converter<String, Date> {

  SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");

  @Override
  public Date convert(String s) {
    try {
      // 将字符串修改成时间
      return sdf.parse(s);
    } catch (ParseException e) {
      e.printStackTrace();
    }
    return null;
  }
}
```

Service 层

```java
@Service
public class EmployeeService {

  @Autowired
  EmployeeMapper employeeMapper;

  public RespPageBean getEmployeeByPage(Integer page, Integer size, Employee employee, Date[] beginDateScope) {
    if (page != null && size != null) {
      page = (page - 1) * size;
    }
    List<Employee> data = employeeMapper.getEmployeeByPage(page, size, employee, beginDateScope);
    Long total = employeeMapper.getTotal(employee, beginDateScope);
    RespPageBean bean = new RespPageBean();
    bean.setData(data);
    bean.setTotal(total);
    return bean;
  }
}
```

Mapper 层

```xml
<select id="getEmployeeByPage" resultMap="AllEmployeeInfo">
  select e.*,p.`id` as pid,p.`name` as pname,n.`id` as nid,n.`name` as nname,d.`id` as did,d.`name` as
  dname,j.`id` as jid,j.`name` as jname,pos.`id` as posid,pos.`name` as posname from employee e,nation
  n,politicsstatus p,department d,joblevel j,position pos where e.`nationId`=n.`id` and e.`politicId`=p.`id` and
  e.`departmentId`=d.`id` and e.`jobLevelId`=j.`id` and e.`posId`=pos.`id`
  <if test="emp.name !=null and emp.name!=''">
    and e.name like concat('%',#{emp.name},'%')
  </if>
  <if test="emp.politicId !=null">
    and e.politicId =#{emp.politicId}
  </if>
  <if test="emp.nationId !=null">
    and e.nationId =#{emp.nationId}
  </if>
  <if test="emp.departmentId !=null">
    and e.departmentId =#{emp.departmentId}
  </if>
  <if test="emp.jobLevelId !=null">
    and e.jobLevelId =#{emp.jobLevelId}
  </if>
  <if test="emp.engageForm !=null and emp.engageForm!=''">
    and e.engageForm =#{emp.engageForm}
  </if>
  <if test="emp.posId !=null">
    and e.posId =#{emp.posId}
  </if>
  <if test="beginDateScope !=null">
    and e.beginDate between #{beginDateScope[0]} and #{beginDateScope[1]}
  </if>
  <if test="page !=null and size!=null">
    limit #{page},#{size}
  </if>
</select>
<select id="getTotal" resultType="java.lang.Long">
  select count(*) from employee e
  <where>
    <if test="emp!=null">
      <if test="emp.name !=null and emp.name!=''">
        and e.name like concat('%',#{emp.name},'%')
      </if>
      <if test="emp.politicId !=null">
        and e.politicId =#{emp.politicId}
      </if>
      <if test="emp.nationId !=null">
        and e.nationId =#{emp.nationId}
      </if>
      <if test="emp.jobLevelId !=null">
        and e.jobLevelId =#{emp.jobLevelId}
      </if>
      <if test="emp.departmentId !=null">
        and e.departmentId =#{emp.departmentId}
      </if>
      <if test="emp.engageForm !=null and emp.engageForm!=''">
        and e.engageForm =#{emp.engageForm}
      </if>
      <if test="emp.posId !=null">
        and e.posId =#{emp.posId}
      </if>
    </if>
    <if test="beginDateScope !=null">
      and e.beginDate between #{beginDateScope[0]} and #{beginDateScope[1]}
    </if>
  </where>
</select>
```

## 2.1. 员工资料 完成

```vue
<template>
<div>
  <div>
    <div style="display: flex;justify-content: space-between">
      <!-- 左边搜索框 -->
      <div>
        <el-input placeholder="请输入员工名进行搜索，可以直接回车搜索…" prefix-icon="el-icon-search"
                  style="width: 350px;margin-right: 10px;" v-model="keyword"
                  @keydown.enter.native="initEmps"
                  clearable @clear="initEmps" :disabled="showAdvanceSearchView"></el-input>
        <el-button icon="el-icon-search" type="primary" @click="initEmps" :disabled="showAdvanceSearchView">
          搜索
  </el-button>
        <el-button type="primary" @click="showAdvanceSearchView = !showAdvanceSearchView">
          <i :class="showAdvanceSearchView ? 'fa fa-angle-double-up': 'fa fa-angle-double-down'"
             aria-hidden="true"></i>
          高级搜索
  </el-button>
  </div>
      <!-- 右边三个按钮 -->
      <div>
        <!-- 文件上传组件 -->
        <el-upload
                   style="display: inline-flex; margin-right: 8px;"
                   action="/employee/basic/import"
                   :show-file-list="false"
                   :before-upload="beforeUpload"
                   :on-success="onSuccess"
                   :on-error="onError"
                   :disabled="importDataDisable">
          <el-button :disabled="importDataDisable" type="success" :icon="importDataBtnIcon">
            {{importDataBtnText}}
  </el-button>
  </el-upload>
        <el-button type="success" @click="exportData" icon="el-icon-download">
          导出数据
  </el-button>
        <el-button type="primary" icon="el-icon-plus" @click="showAddEmpView">
          添加员工
  </el-button>
  </div>
  </div>
    <!-- 高级搜索 -->
    <transition name="slide-fade">
      <div v-show="showAdvanceSearchView"
           style="border: 1px solid #409eff;border-radius: 5px;box-sizing: border-box;padding: 5px;margin: 10px 0px;">
        <el-row>
          <el-col :span="5">
            政治面貌:
            <el-select v-model="searchValue.politicId" placeholder="政治面貌" size="mini"
                       style="width: 130px;">
              <el-option
                         v-for="item in politicsstatus"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
  </el-option>
  </el-select>
  </el-col>
          <el-col :span="4">
            民族:
            <el-select v-model="searchValue.nationId" placeholder="民族" size="mini"
                       style="width: 150px;">
              <el-option
                         v-for="item in nations"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
  </el-option>
  </el-select>
  </el-col>
          <el-col :span="4">
            职位:
            <el-select v-model="searchValue.posId" placeholder="职位" size="mini" style="width: 130px;">
              <el-option
                         v-for="item in positions"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
  </el-option>
  </el-select>
  </el-col>
          <el-col :span="4">
            职称:
            <el-select v-model="searchValue.jobLevelId" placeholder="职称" size="mini"
                       style="width: 130px;">
              <el-option
                         v-for="item in joblevels"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
  </el-option>
  </el-select>
  </el-col>
          <el-col :span="7">
            聘用形式:
            <el-radio-group v-model="searchValue.engageForm">
              <el-radio label="劳动合同">劳动合同</el-radio>
              <el-radio label="劳务合同">劳务合同</el-radio>
  </el-radio-group>
  </el-col>
  </el-row>
        <el-row style="margin-top: 10px;">
          <el-col :span="5">
            所属部门:
            <el-popover
                        placement="right"
                        title="请选择部门"
                        width="200"
                        trigger="manual"
                        v-model="popVisible">
              <el-tree :data="allDeps" default-expand-all :props="defaultProps"
                       @node-click="searchViewHandleNodeClick"></el-tree>
              <div slot="reference" style="width: 130px;display: inline-flex;font-size: 13px;
                                           border: 1px solid #dedede; height: 26px;border-radius: 5px;cursor: pointer;
                                           align-items: center;padding-left: 8px;box-sizing: border-box;margin-left: 3px;"
                   @click="showDepView">
                {{inputDepName}}
  </div>
  </el-popover>
  </el-col>
          <el-col :span="10">
            入职日期:
            <el-date-picker
                            v-model="searchValue.beginDateScope"
                            type="daterange"
                            size="mini"
                            unlink-panels
                            value-format="yyyy-MM-dd"
                            range-separator="至"
                            start-placeholder="开始日期"
                            end-placeholder="结束日期">
  </el-date-picker>
  </el-col>
          <el-col :span="5" :offset="4">
            <el-button size="mini">取消</el-button>
            <el-button size="mini" icon="el-icon-search" type="primary" @click="initEmps('advanced')">搜索
  </el-button>
  </el-col>
  </el-row>
  </div>
  </transition>
  </div>
  <!-- 表格 -->
  <div style="margin-top: 10px;">
    <el-table
              :data="emps"
              stripe
              v-loading="loading"
              element-loading-text="正在加载中…"
              element-loading-spinner="el-icon-loading"
              element-loading-background="rgba(0, 0, 0, 0.8)"
              border
              style="width: 100%">
      <el-table-column
                       type="selection"
                       width="55">
  </el-table-column>
      <el-table-column
                       prop="name"
                       label="姓名"
                       fixed
                       align="center"
                       width="90">
  </el-table-column>
      <el-table-column
                       prop="workID"
                       label="工号"
                       align="left"
                       width="85">
  </el-table-column>
      <el-table-column
                       prop="gender"
                       label="性别"
                       align="left"
                       width="50">
  </el-table-column>
      <el-table-column
                       prop="birthday"
                       label="出生日期"
                       align="center"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="idCard"
                       label="身份证号码"
                       align="center"
                       width="150">
  </el-table-column>
      <el-table-column
                       prop="wedlock"
                       label="婚姻状况"
                       align="center"
                       width="70">
  </el-table-column>
      <el-table-column
                       prop="nation.name"
                       label="民族"
                       align="center"
                       width="50">
  </el-table-column>
      <el-table-column
                       prop="nativePlace"
                       label="籍贯"
                       align="left"
                       width="80">
  </el-table-column>
      <el-table-column
                       prop="politicsstatus.name"
                       align="center"
                       label="政治面貌">
  </el-table-column>
      <el-table-column
                       prop="email"
                       label="电子邮件"
                       align="left"
                       width="180">
  </el-table-column>
      <el-table-column
                       prop="phone"
                       label="电话号码"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="address"
                       label="联系地址"
                       align="left"
                       width="220">
  </el-table-column>
      <el-table-column
                       prop="department.name"
                       label="所属部门"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="position.name"
                       label="职位"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="jobLevel.name"
                       label="职称"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="engageForm"
                       label="聘用形式"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="tiptopDegree"
                       label="最高学历"
                       align="left"
                       width="100">
  </el-table-column>
      <el-table-column
                       prop="specialty"
                       label="专业"
                       align="left"
                       width="150">
  </el-table-column>
      <el-table-column
                       prop="school"
                       label="毕业院校"
                       align="left"
                       width="150">
  </el-table-column>
      <el-table-column
                       prop="beginDate"
                       label="入职日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="conversionTime"
                       label="转正日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="beginContract"
                       label="合同起始日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       prop="endContract"
                       label="合同截止日期"
                       align="left"
                       width="95">
  </el-table-column>
      <el-table-column
                       label="合同期限"
                       align="left"
                       width="100">
        <template slot-scope="scope">
          <el-tag>{{scope.row.contractTerm}}</el-tag>
          年
</template>
</el-table-column>
<el-table-column
                 fixed="right"
                 width="200"
                 label="操作">
  <template slot-scope="scope">
<el-button @click="showEditEmpView(scope.row)" style="padding: 2px" size="mini">编辑</el-button>
<el-button style="padding: 2px" size="mini" type="primary">查看高级资料</el-button>
<el-button @click="deleteEmp(scope.row)" style="padding: 2px" size="mini" type="danger">删除
    </el-button>
  </template>
</el-table-column>
</el-table>
<div style="display: flex;justify-content: flex-end;">
  <el-pagination
                 @current-change="currentChange"
                 @size-change="sizeChange"
                 background
                 layout="sizes, prev, pager, next, jumper, ->, total, slot"
                 :total="total">
  </el-pagination>
</div>
</div>
<!-- 添加员工/编辑员工的弹窗 -->
<el-dialog
           :title="dialogTitle"
           @close="closeDialog"
           :visible.sync="dialogVisible"
           width="80%">

  <div>
    <!-- 添加员工的表单 -->
    <el-form :model="emp" :rules="empRules" ref="empForm">
      <el-row>
        <el-col :span="6">
          <el-form-item label="姓名:" prop="name">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-edit"
                      v-model="emp.name" placeholder="请输入员工新名…"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="性别:" prop="gender">
            <el-radio-group v-model="emp.gender">
              <el-radio label="男">男</el-radio>
              <el-radio label="女">女</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="出生日期:" prop="birthday">
            <el-date-picker
                            v-model="emp.birthday"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 150px;"
                            placeholder="出生日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="政治面貌:" prop="politicId">
            <el-select v-model="emp.politicId" placeholder="政治面貌" size="mini" style="width: 200px;">
              <el-option
                         v-for="item in politicsstatus"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="6">
          <el-form-item label="民族:" prop="nationId">
            <el-select v-model="emp.nationId" placeholder="民族" size="mini" style="width: 200px;">
              <el-option
                         v-for="item in nations"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="籍贯:" prop="nativePlace">
            <el-input size="mini" style="width: 120px;" prefix-icon="el-icon-edit"
                      v-model="emp.nativePlace" placeholder="请输入籍贯"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="电子邮箱:" prop="email">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-message"
                      v-model="emp.email" placeholder="请输入邮箱"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="联系地址:" prop="address">
            <el-input size="mini" style="width: 200px;" prefix-icon="el-icon-edit"
                      v-model="emp.address" placeholder="请输入联系地址"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="6">
          <el-form-item label="职位:" prop="posId">
            <el-select v-model="emp.posId" placeholder="职位" size="mini" style="width: 150px;">
              <el-option
                         v-for="item in positions"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="职称:" prop="jobLevelId">
            <el-select v-model="emp.jobLevelId" placeholder="职称" size="mini" style="width: 150px;">
              <el-option
                         v-for="item in joblevels"
                         :key="item.id"
                         :label="item.name"
                         :value="item.id">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="所属部门:" prop="departmentId">
            <el-popover
                        placement="right"
                        title="请选择部门"
                        width="200"
                        trigger="manual"
                        v-model="popVisible">
              <el-tree :data="allDeps" default-expand-all :props="defaultProps"
                       @node-click="handleNodeClick"></el-tree>
              <div slot="reference" style="width: 150px;display: inline-flex;font-size: 13px;
                                           border: 1px solid #dedede; height: 26px;border-radius: 5px;cursor: pointer;
                                           align-items: center;padding-left: 8px;box-sizing: border-box" @click="showDepView">
                {{inputDepName}}
              </div>
            </el-popover>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="电话号码:" prop="phone">
            <el-input size="mini" style="width: 200px;" prefix-icon="el-icon-phone"
                      v-model="emp.phone" placeholder="电话号码"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="6">
          <el-form-item label="工号:" prop="workID">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-edit"
                      v-model="emp.workID" placeholder="工号" disabled></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="5">
          <el-form-item label="学历:" prop="tiptopDegree">
            <el-select v-model="emp.tiptopDegree" placeholder="学历" size="mini"
                       style="width: 150px;">
              <el-option
                         v-for="item in tiptopDegrees"
                         :key="item"
                         :label="item"
                         :value="item">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="毕业院校:" prop="school">
            <el-input size="mini" style="width: 150px;" prefix-icon="el-icon-edit"
                      v-model="emp.school" placeholder="毕业院校名称"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="7">
          <el-form-item label="专业名称:" prop="specialty">
            <el-input size="mini" style="width: 200px;" prefix-icon="el-icon-phone"
                      v-model="emp.specialty" placeholder="专业名称"></el-input>
          </el-form-item>
        </el-col>
      </el-row>

      <el-row>
        <el-col :span="6">
          <el-form-item label="入职日期:" prop="beginDate">
            <el-date-picker
                            v-model="emp.beginDate"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 130px;"
                            placeholder="入职日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="转正日期:" prop="conversionTime">
            <el-date-picker
                            v-model="emp.conversionTime"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 130px;"
                            placeholder="转正日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="合同起始日期:" prop="beginContract">
            <el-date-picker
                            v-model="emp.beginContract"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 130px;"
                            placeholder="合同起始日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
        <el-col :span="6">
          <el-form-item label="合同终止日期:" prop="endContract">
            <el-date-picker
                            v-model="emp.endContract"
                            size="mini"
                            type="date"
                            value-format="yyyy-MM-dd"
                            style="width: 150px;"
                            placeholder="合同终止日期">
            </el-date-picker>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="8">
          <el-form-item label="身份证号码:" prop="idCard">
            <el-input size="mini" style="width: 180px;" prefix-icon="el-icon-edit"
                      v-model="emp.idCard" placeholder="请输入身份证号码"></el-input>
          </el-form-item>
        </el-col>
        <el-col :span="8">
          <el-form-item label="聘用形式:" prop="engageForm">
            <el-radio-group v-model="emp.engageForm">
              <el-radio label="劳动合同">劳动合同</el-radio>
              <el-radio label="劳务合同">劳务合同</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
        <el-col :span="8">
          <el-form-item label="婚姻状况:" prop="wedlock">
            <el-radio-group v-model="emp.wedlock">
              <el-radio label="已婚">已婚</el-radio>
              <el-radio label="未婚">未婚</el-radio>
              <el-radio label="离异">离异</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
      </el-row>
    </el-form>
  </div>

  <span slot="footer" class="dialog-footer">
    <el-button @click="dialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="doAddEmp">确 定</el-button>
  </span>
</el-dialog>
</div>
</template>

<script>
  export default {
    name: "EmpBasic",
    data() {
      return {
        dialogTitle: '',
        importDataBtnText: '导入数据',
        importDataBtnIcon: 'el-icon-upload2',
        importDataDisable: false,
        emps: [],
        allDeps: [],
        loading: false,
        total: 0,
        page: 1,
        size: 10,
        keyword: '',
        dialogVisible: false,
        nations: [],
        joblevels: [],
        politicsstatus: [],
        positions: [],
        emp: {
          name: "rocketWizt",
          gender: "男",
          birthday: "1990-01-01",
          idCard: "610122199001011256",
          wedlock: "已婚",
          nationId: 1,
          nativePlace: "陕西",
          politicId: 13,
          email: "laowang@qq.com",
          phone: "18565558897",
          address: "深圳市南山区",
          departmentId: null,
          jobLevelId: 9,
          posId: 29,
          engageForm: "劳务合同",
          tiptopDegree: "本科",
          specialty: "信息管理与信息系统",
          school: "深圳大学",
          beginDate: "2018-01-01",
          workState: "在职",
          workID: "00000070",
          contractTerm: 2.0,
          conversionTime: "2018-04-01",
          notworkDate: null,
          beginContract: "2018-01-01",
          endContract: "2020-01-01",
          workAge: null
        },
        tiptopDegrees: ['本科', '大专', '硕士', '博士', '高中', '初中', '小学', '其他'],
        popVisible: false,
        defaultProps: {
          children: 'children',
          label: 'name'
        },
        inputDepName: '所属部门',
        empRules: {
          name: [{required: true, message: '请输入用户名', trigger: 'blur'}],
          gender: [{required: true, message: '请选择性别', trigger: 'blur'}],
          birthday: [{required: true, message: '请输入出生日期', trigger: 'blur'}],
          idCard: [{
            required: true,
            message: '请输入身份证号码',
            trigger: 'blur'
          }, {
            pattern: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,
            message: '身份证号码格式不正确',
            trigger: 'blur'
          }
                  ],
          wedlock: [{required: true, message: '请选择婚姻状况', trigger: 'blur'}],
          nationId: [{required: true, message: '请选择民族', trigger: 'blur'}],
          nativePlace: [{required: true, message: '请输入籍贯', trigger: 'blur'}],
          politicId: [{required: true, message: '请选择政治面貌', trigger: 'blur'}],
          email: [{
            required: true,
            message: '请输入邮箱',
            trigger: 'blur'
          }, {
            type: 'email',
            message: '邮箱格式不正确',
            trigger: 'blur'
          }],
          phone: [{required: true, message: '请输入手机号码', trigger: 'blur'}],
          address: [{required: true, message: '请输入员工地址', trigger: 'blur'}],
          departmentId: [{required: true, message: '请选择部门名称', trigger: 'blur'}],
          jobLevelId: [{required: true, message: '请选择职称', trigger: 'blur'}],
          posId: [{required: true, message: '请选择职位', trigger: 'blur'}],
          engageForm: [{required: true, message: '请选择聘用形式', trigger: 'blur'}],
          tiptopDegree: [{required: true, message: '请输入学位', trigger: 'blur'}],
          specialty: [{required: true, message: '请输入专业', trigger: 'blur'}],
          school: [{required: true, message: '请输入毕业院校', trigger: 'blur'}],
          beginDate: [{required: true, message: '请输入入职日期', trigger: 'blur'}],
          workState: [{required: true, message: '请输入工作状况', trigger: 'blur'}],
          workID: [{required: true, message: '请输入工号', trigger: 'blur'}],
          contractTerm: [{required: true, message: '请输入合同期限', trigger: 'blur'}],
          conversionTime: [{required: true, message: '请输入转正日期', trigger: 'blur'}],
          notworkDate: [{required: true, message: '请输入离职日期', trigger: 'blur'}],
          beginContract: [{required: true, message: '请输入合同起始日期', trigger: 'blur'}],
          endContract: [{required: true, message: '请输入合同结束日期', trigger: 'blur'}],
          workAge: [{required: true, message: '请输入工龄', trigger: 'blur'}],
        },
        showAdvanceSearchView: false,
        // 高级搜索存值对象
        searchValue: {
          politicId: null,
          nationId: null,
          jobLevelId: null,
          posId: null,
          engageForm: null,
          departmentId: null,
          beginDateScope: null
        },
      }
    },
    mounted() {
      this.initEmps()
      this.initData()
      this.initPositions()
    },
    methods: {
      initPositions() {
        this.getRequest("/employee/basic/positions").then(res => {
          if (res) {
            this.positions = res
          }
        })
      },
      initData() {
        if (!window.sessionStorage.getItem("nations")) {
          this.getRequest("/employee/basic/nations").then(res => {
            if (res) {
              this.nations = res
              window.sessionStorage.setItem("nations", JSON.stringify(res))
            }
          })
        } else {
          this.nations = JSON.parse(window.sessionStorage.getItem("nations"))
        }
        if (!window.sessionStorage.getItem("politicsstatus")) {
          this.getRequest("/employee/basic/politicsstatus").then(res => {
            if (res) {
              this.politicsstatus = res
              window.sessionStorage.setItem("politicsstatus", JSON.stringify(res))
            }
          })
        } else {
          this.politicsstatus = JSON.parse(window.sessionStorage.getItem("politicsstatus"))
        }
        if (!window.sessionStorage.getItem("joblevels")) {
          this.getRequest("/employee/basic/jobLevels").then(res => {
            if (res) {
              this.joblevels = res
              window.sessionStorage.setItem("joblevels", JSON.stringify(res))
            }
          })
        } else {
          this.joblevels = JSON.parse(window.sessionStorage.getItem("joblevels"))
        }
        if (!window.sessionStorage.getItem("allDeps")) {
          this.getRequest("/employee/basic/deps").then(res => {
            if (res) {
              this.allDeps = res
              window.sessionStorage.setItem("allDeps", JSON.stringify(res))
            }
          })
        } else {
          this.allDeps = JSON.parse(window.sessionStorage.getItem("allDeps"))
        }
      },
      initEmps(type) {
        this.loading = true
        let url = '/employee/basic/?page=' + this.page + '&size=' + this.size;
        // 如果类型是高级搜索则使用高级搜索请求，否则则使用普通搜索请求
        if (type && type == 'advanced') {
          // 高级搜索中需要判断：如果存在值就添加这个查询字段，如果不存在就不添加
          if (this.searchValue.politicId) {
            url += '&politicId=' + this.searchValue.politicId;
          }
          if (this.searchValue.nationId) {
            url += '&nationId=' + this.searchValue.nationId;
          }
          if (this.searchValue.jobLevelId) {
            url += '&jobLevelId=' + this.searchValue.jobLevelId;
          }
          if (this.searchValue.posId) {
            url += '&posId=' + this.searchValue.posId;
          }
          if (this.searchValue.engageForm) {
            url += '&engageForm=' + this.searchValue.engageForm;
          }
          if (this.searchValue.departmentId) {
            url += '&departmentId=' + this.searchValue.departmentId;
          }
          if (this.searchValue.beginDateScope) {
            url += '&beginDateScope=' + this.searchValue.beginDateScope;
          }
        } else {
          url +=  "&name=" + this.keyword
        }
        console.log(url);
        this.getRequest(url).then(res => {
          this.loading = false
          if (res) {
            this.total = res.total
            this.emps = res.data
          }
        })
      },
      // 页发生变化
      currentChange(currentPage) {
        this.page = currentPage;
        this.initEmps()
      },
      // 条数发生变化
      sizeChange(currentSize) {
        this.size = currentSize;
        this.initEmps()
      },
      // 添加员工的弹出框
      showAddEmpView() {
        this.emptyEmp();
        this.dialogTitle = '添加员工'
        this.dialogVisible = true
        this.getMaxWorkID()
      },
      getMaxWorkID() {
        this.getRequest("/employee/basic/maxWorkID").then(res => {
          if (res) {
            this.emp.workID = res.obj
          }
        })
      },
      // 所属部门点击打开弹出窗
      showDepView() {
        this.popVisible = !this.popVisible
      },
      // 树的点击事件
      handleNodeClick(data) {
        this.popVisible = !this.popVisible
        this.emp.departmentId = data.id
        this.inputDepName = data.name
      },
      // 添加员工的确认按钮
      doAddEmp() {
        if (this.emp.id) {
          this.$refs.empForm.validate(valid => {
            if (valid) {
              this.putRequest("/employee/basic/", this.emp).then(res => {
                if (res) {
                  this.dialogVisible = false
                  this.initEmps()
                }
              })
            }
          })
        } else {
          this.$refs.empForm.validate(valid => {
            if (valid) {
              this.postRequest("/employee/basic/", this.emp).then(res => {
                if (res) {
                  this.dialogVisible = false
                  this.initEmps()
                }
              })
            }
          })
        }
      },
      // 删除员工
      deleteEmp(data) {
        this.$confirm('此操作将永久删除【' + data.name + '】, 是否继续?', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          this.deleteRequest("/employee/basic/" + data.id).then(res => {
            if (res) {
              this.initEmps();
            }
          })
        }).catch(() => {
          this.$message({
            type: 'info',
            message: '已取消删除'
          });
        });
      },
      // 编辑员工
      showEditEmpView(data) {
        this.inputDepName = data.department.name
        this.initPositions();
        this.dialogVisible = true
        this.dialogTitle = '编辑员工信息'
        this.emp = data
      },
      // 清空emp
      emptyEmp() {
        this.emp = {
          name: "",
          gender: "",
          birthday: "",
          idCard: "",
          wedlock: "",
          nationId: 1,
          nativePlace: "",
          politicId: 13,
          email: "",
          phone: "",
          address: "",
          departmentId: null,
          jobLevelId: 9,
          posId: 29,
          engageForm: "",
          tiptopDegree: "本科",
          specialty: "",
          school: "",
          beginDate: "",
          workID: null,
          contractTerm: 2.0,
          conversionTime: "",
          notworkDate: null,
          beginContract: "",
          endContract: "",
          workAge: null
        }
        this.inputDepName = ''
      },
      closeDialog() {
        this.$refs.empForm.resetFields();
      },
      // 导出Excel
      exportData() {
        window.open('/employee/basic/export', '_parent')
      },
      // 上传成功
      onSuccess(response, file, fileList) {
        this.importDataBtnText = '导入数据'
        this.importDataBtnIcon = 'el-icon-upload2'
        this.importDataDisable = false
        this.initEmps()
      },
      // 上传失败
      onError() {
        this.importDataBtnText = '导入数据'
        this.importDataBtnIcon = 'el-icon-upload2'
        this.importDataDisable = false
      },
      // 上传之前
      beforeUpload() {
        this.importDataBtnText = '正在导入'
        this.importDataBtnIcon = 'el-icon-loading'
        this.importDataDisable = true
      },
      // 高级输入框的树点击事件（所属部门）
      searchViewHandleNodeClick(data){
        this.popVisible = !this.popVisible
        this.emp.departmentId = data.id
        this.inputDepName = data.name
      }
    }
  }
</script>

<style scoped>
  /* 可以设置不同的进入和离开动画 */
  /* 设置持续时间和动画函数 */
  .slide-fade-enter-active {
    transition: all .8s ease;
  }

  .slide-fade-leave-active {
    transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);
  }

  .slide-fade-enter, .slide-fade-leave-to
  /* .slide-fade-leave-active for below version 2.1.8 */
  {
    transform: translateX(10px);
    opacity: 0;
  }
</style>
```











1、如何获取当前用户登录的ID？

```java
Hr hr = ((Hr) SecurityContextHolder.getContext().getAuthentication().getPrincipal())
```

2 、当数据库中某些数据对应关系过于复杂时，直接先删掉所有信息再进行更新

* 注意删除的时候需要给Service对应的方法上添加事务注解 `@Transactional`

3、设置一个 Bean 类，当这个类中存在一个 List 需要进行泛型控制但又不知道泛型的对象时，可以使用 `List<?>`

4、关于日期数据的插入：

* 在后端设置了 `@JsonFormat` 进行日期格式化后，前端传递过来的日期数据也需要进行格式化处理，格式需要和后端 `@JsonFormat` 格式一致
* 如果使用 element 的 **DatePicker 日期选择器**，需要通过设置属性 `value-format` 来格式化前端传递的日期 

5、关于Bean的build

1. 新建一个 build 的静态方法，返回当前类实例对象。
2. Setting 需要返回 RepsBean（当前类）

```java
public class RespBean {
  private Integer status;
  private String msg;
  private Object obj;

  // 新建一个build静态方法
  public static RespBean build(){
    return new RespBean();
  }

  public static RespBean ok(String msg) {
    return new RespBean(200, msg, null);
  }
  public static RespBean ok(String msg, Object obj) {
    return new RespBean(200, msg, obj);
  }
  public static RespBean error(String msg) {
    return new RespBean(500, msg, null);
  }
  public static RespBean error(String msg, Object obj) {
    return new RespBean(500, msg, obj);
  }

  private RespBean() {

  }

  private RespBean(Integer status, String msg, Object obj) {
    this.status = status;
    this.msg = msg;
    this.obj = obj;
  }

  public Integer getStatus() {
    return status;
  }

  // 返回 RespBean
  public RespBean setStatus(Integer status) {
    this.status = status;
    return this;
  }

  public String getMsg() {
    return msg;
  }

  // 返回 RespBean
  public RespBean setMsg(String msg) {
    this.msg = msg;
    return this;
  }

  public Object getObj() {
    return obj;
  }

  // 返回 RespBean
  public RespBean setObj(Object obj) {
    this.obj = obj;
    return this;
  }
}
```

使用：

```java
@GetMapping("/maxWorkID")
public RespBean maxWorkID(){
  RespBean respBean = RespBean.build().setStatus(200)
    .setObj(String.format("%08d", employeeService.maxWorkID() + 1));
  return respBean;
}
```

6、前端存Json数据进 sessionStorage

存值

```js
window.sessionStorage.setItem("nations", JSON.stringify(res))
```

取值

```js
this.nations = JSON.parse(window.sessionStorage.getItem("nations"))
```

7、`DecimalFormat`  格式化数据 和 `SimpleDateFormat` 格式化日期

**`DecimalFormat`** ：将数据转换成格式化的值

①、占位符：`0` 和 `#`

* `0` 占位符

  ```java
  new DecimalFormat("00.00").format(3.14567);//结果：03.15
  new DecimalFormat("0.000").format(3.14);//结果：3.140
  new DecimalFormat("00.000").format(3.14);//结果：03.140
  ```

  总结：占位符比实际数字的位数多，不足的地方用0补上

* `#` 占位符

  ```java
  new DecimalFormat("##.##").format(3.14567);//结果：3.15
  new DecimalFormat("#.###").format(3.14);//结果：3.14
  new DecimalFormat("##.###").format(3.14);//结果：3.14
  ```

  总结：只保留有效数字，不会多添加数字

两种占位符在小数部分 默认使用四舍五入（**RoundingMode.HALF_EVEN**）

②、格式化方式设置：

```java
//指定舍入方式为：RoundingMode.DOWN，直接舍去格式化以外的部分
format.setRoundingMode(RoundingMode.DOWN);
String formatDown = format.format(13.14567);//结果：13.14
//指定舍入方式为：RoundingMode.HALF_UP，四舍五入
format.setRoundingMode(RoundingMode.HALF_UP);
```

>  https://www.jianshu.com/p/c1dec1796062 

**`SimpleDateFormat`** ：将日期格式化为我们期望的格式

```java
/**
  SimpleDateFormat函数语法：

  G 年代标志符
  y 年
  M 月
  d 日
  h 时 在上午或下午 (1~12)
  H 时 在一天中 (0~23)
  m 分
  s 秒
  S 毫秒
  E 星期
  D 一年中的第几天
  F 一月中第几个星期几
  w 一年中第几个星期
  W 一月中第几个星期
  a 上午 / 下午 标记符
  k 时 在一天中 (1~24)
  K 时 在上午或下午 (0~11)
  z 时区
 */
SimpleDateFormat myFmt=new SimpleDateFormat("yyyy年MM月dd日 HH时mm分ss秒");
SimpleDateFormat myFmt1=new SimpleDateFormat("yy/MM/dd HH:mm");
SimpleDateFormat myFmt2=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");//等价于now.toLocaleString()
SimpleDateFormat myFmt3=new SimpleDateFormat("yyyy年MM月dd日 HH时mm分ss秒 E ");
SimpleDateFormat myFmt4=new SimpleDateFormat(
  "一年中的第 D 天 一年中第w个星期 一月中第W个星期 在一天中k时 z时区");
```

>  https://blog.csdn.net/gubaohua/article/details/575488 

8、后端返回文件 `ResponseEntity<byte[]>` 以及接收文件 `MultipartFile`

```java
@RequestMapping("/testResponseEntity")
public ResponseEntity<byte[]> testResponseEntity(HttpSession session) throws IOException {
  byte[] body=null;
  ServletContext sc=session.getServletContext();
  InputStream in=sc.getResourceAsStream("/files/11.txt");
  body=new byte[in.available()];
  in.read(body);

  HttpHeaders headers=new HttpHeaders();
  headers.add("Content-Disposition","attachment;filename=11.txt");

  HttpStatus statusCode=HttpStatus.OK;

  ResponseEntity<byte[]> response=new ResponseEntity<byte[]>(body,headers,statusCode);
  return response;
}
```

 https://www.javatt.com/p/25425 

9、前后端分离文件上传

* element 的 Update 组件
* Ajax

10、可以通过 equles 来判断当前类的内容是否符合信息

11、使用 Vue 的动画过渡： [https://cn.vuejs.org/v2/guide/transitions.html#%E6%A6%82%E8%BF%B0](https://cn.vuejs.org/v2/guide/transitions.html#概述) 

12、如果参数不匹配需要创建转换器，比如下面的日期转换字符串转换器

* 当创建了此转换器后，我们就可以直接修改前端接收的数据，将需要转换的数据类型直接修改成 Date 类型，会自动帮助转换

```java
// 这里通过接入 Converter<String, Date> 实现 String => Date
@Component
public class DateConverter implements Converter<String, Date> {
  SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
  
  @Override
  public Date convert(String s) {
    try {
      return sdf.parse(s);
    } catch (ParseException e) {
      e.printStackTrace();
    }
    return null;
  }
}
// sdf.parse()：将字符串修改成日期
// sdf.format()：将日期修改成字符串
```

使用转换器后，接口的日期参数 `beginDateScope` 可以从 `String[] 换成 Date[]` ，打印输出，看 `beginDateScope` 内容有什么变化

```java
// 获取所有员工信息（带有分页功能）
@GetMapping("/")
public RespPageBean getEmployeeByPage(@RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "10") Integer size,Employee employee, Date[] beginDateScope) {
  System.out.println(employee);
  System.out.println(Arrays.toString(beginDateScope));
  return employeeService.getEmployeeByPage(page, size, employee);
}
```

```shell
# 没创建转换器 且 接收beginDateScope参数的类型为 String[]
[2020-05-04, 2020-05-22]
# 创建了转换器 且 接收beginDateScope参数的类型为 Date[]
[Sun May 03 00:00:00 CST 2020, Sat May 23 00:00:00 CST 2020]
```







